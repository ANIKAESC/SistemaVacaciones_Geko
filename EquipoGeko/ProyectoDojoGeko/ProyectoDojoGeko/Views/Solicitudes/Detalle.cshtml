@model ProyectoDojoGeko.Models.SolicitudViewModel
@{
    var tituloEstado = Model.Encabezado.Estado == 6 ? "Solicitud Rechazada" : 
                       Model.Encabezado.Estado == 2 ? "Solicitud Autorizada" : 
                       "Detalle de Solicitud";
    ViewData["Title"] = $"{tituloEstado} - GEKO Sistemas de Seguridad";
    Layout = "~/Views/Shared/_DashboardLayout.cshtml";
    var empleado = ViewBag.Empleado;
    var idAutorizador = Context.Session.GetInt32("IdEmpleado") ?? 0;
}

<link rel="stylesheet" href="~/css/empleado-detalle.css" />
<link rel="stylesheet" href="~/css/detalle-solicitud.css" />

<div class="empleado-detalle-container" id="contenido-pdf">
    <!-- Encabezado -->
    <div class="page-header">
        <div class="header-content">
            <h1 class="page-title">
                @if (Model.Encabezado.Estado == 6)
                {
                    <i class="fas fa-times-circle" style="color: #DC2626;"></i>
                    <span>Solicitud Rechazada</span>
                }
                else if (Model.Encabezado.Estado == 2)
                {
                    <i class="fas fa-check-circle" style="color: #16A34A;"></i>
                    <span>Solicitud Autorizada</span>
                }
                else
                {
                    <i class="fas fa-id-card icon-naranja"></i>
                    <span>Detalle de Solicitud</span>
                }
            </h1>
            <p class="page-subtitle">Informaci칩n detallada sobre la solicitud de vacaciones</p>
        </div>
    </div>

    @* Mensajes de 칠xito o error *@
    @if (TempData["SuccessMessage"] != null)
    {
        <div class="alert alert-success alert-dismissible fade show" role="alert" style="margin-bottom: 20px; background: #D1FAE5; border-left: 4px solid #10B981; color: #065F46; padding: 20px; font-size: 18px;">
            <h4 style="margin: 0 0 10px 0; color: #065F46;">
                <i class="fas fa-check-circle"></i> 춰Operaci칩n Exitosa!
            </h4>
            <p style="margin: 0; font-size: 16px;">@TempData["SuccessMessage"]</p>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }
    @if (TempData["MensajeError"] != null)
    {
        <div class="alert alert-danger alert-dismissible fade show" role="alert" style="margin-bottom: 20px; background: #FEE2E2; border-left: 4px solid #DC2626; color: #991B1B;">
            <i class="fas fa-exclamation-circle"></i> @TempData["MensajeError"]
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }
    
    @* Alerta especial si la solicitud est치 rechazada *@
    @if (Model.Encabezado.Estado == 6 && !string.IsNullOrEmpty(Model.Encabezado.MotivoRechazo))
    {
        <div class="alert alert-warning" role="alert" style="margin-bottom: 20px; background: #FEF3C7; border-left: 4px solid #F59E0B; color: #92400E;">
            <h5 style="margin: 0 0 0.5rem 0; color: #92400E;">
                <i class="fas fa-exclamation-triangle"></i> Esta solicitud fue rechazada
            </h5>
            <p style="margin: 0;">El autorizador ha rechazado tu solicitud. Revisa el motivo en la secci칩n inferior.</p>
        </div>
    }

    <div class="empleado-card">
        <!-- Tarjeta de resumen -->
        <div class="info-box">
            <h2 class="empleado-nombre-s">@empleado?.NombresEmpleado @empleado?.ApellidosEmpleado</h2>
            <p class="empleado-id">N칰mero de solicitud: <strong>@Model.Encabezado.IdSolicitud</strong></p>
            <div class="estado-box">
                <span class="badge estado-@Model.Encabezado.Estado">
                    <i class="fas fa-info-circle"></i> @Model.Encabezado.Estado
                </span>
            </div>
            <div class="detalle-mini-grid">
                <div class="stat-item">
                    <div class="stat-label">D칤as solicitados</div>
                    <div class="stat-value">@Model.Encabezado.DiasSolicitadosTotal d칤as</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Fecha de creaci칩n</div>
                    <div class="stat-value">@Model.Encabezado.FechaIngresoSolicitud.ToString("dd/MM/yyyy")</div>
                </div>
            </div>
        </div>

        <!-- Informaci칩n del Empleado -->
        <div class="info-section">
            <div class="section-header">
                <h3 class="section-title">
                    <i class="fas fa-user icon-naranja"></i> Informaci칩n del Empleado
                </h3>
            </div>
            <div class="info-grid">
                <div class="info-item">
                    <div class="info-label"><i class="fas fa-id-card icon-naranja"></i> C칩digo</div>
                    <div class="info-value">@empleado?.CodigoEmpleado</div>
                </div>
                <div class="info-item">
                    <div class="info-label"><i class="fas fa-user icon-naranja"></i> Nombre:</div>
                    <div class="info-value">@empleado?.NombresEmpleado @empleado?.ApellidosEmpleado</div>
                </div>
                <div class="info-item">
                    <div class="info-label"><i class="fas fa-building icon-naranja"></i> Departamento</div>
                    <div class="info-value">@empleado?.Departamento</div>
                </div>
                <div class="info-item">
                    <div class="info-label"><i class="fas fa-briefcase icon-naranja"></i> Puesto</div>
                    <div class="info-value">@empleado?.Puesto</div>
                </div>
@*                 <div class="info-item">
                    <div class="info-label"><i class="fas fa-calendar-plus icon-naranja"></i> Fecha de Ingreso</div>
                    <div class="info-value">@(empleado?.FechaIngreso?.ToString("dd/MM/yyyy") ?? "")</div>
                </div> *@
                <div class="info-item">
                    <div class="info-label"><i class="fas fa-envelope icon-naranja"></i> Correo</div>
                    <div class="info-value">@empleado?.CorreoInstitucional</div>
                </div>
                <div class="info-item">
                    <div class="info-label"><i class="fas fa-phone icon-naranja"></i> Tel칠fono</div>
                    <div class="info-value">@empleado?.Telefono</div>
                </div>
@*                 <div class="info-item">
                    <div class="info-label"><i class="fas fa-map-marker-alt icon-naranja"></i> Direcci칩n</div>
                    <div class="info-value">@empleado?.Direccion</div>
                </div>
              *@
                <div class="info-item">
                    <div class="info-label"><i class="fas fa-id-card icon-naranja"></i> DPI</div>
                    <div class="info-value">@empleado?.DPI</div>
                </div>
             

            </div>
        </div>

        <!-- Tabla de fechas -->
        <div class="info-section">
            <div class="section-header">
                <h3 class="section-title">
                    <i class="fas fa-calendar-alt icon-naranja"></i> Fechas Solicitadas
                </h3>
            </div>
            <div class="table-responsive">
                <table class="table table-striped table-bordered text-center align-middle tabla-fechas-solicitadas">
                    <thead class="table-light">
                        <tr>
                            <th>Fecha Inicio</th>
                            <th>Fecha Fin</th>
                            <th>D칤as H치biles</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var d in Model.Detalles)
                        {
                            <tr>
                                <td>@d.FechaInicio.ToString("dd/MM/yyyy")</td>
                                <td>@d.FechaFin.ToString("dd/MM/yyyy")</td>
                                <td>@d.DiasHabilesTomados</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Vista Previa del PDF con Firma del Empleado -->
        <div class="info-section">
            <div class="section-header">
                <h3 class="section-title">
                    <i class="fas fa-file-pdf icon-naranja"></i> Vista Previa del Documento con Firma del Empleado
                </h3>
            </div>
            <div class="pdf-preview-container">
                <iframe id="pdfPreview" 
                        src="@Url.Action("VisualizarPDF", "Solicitudes", new { idSolicitud = Model.Encabezado.IdSolicitud })" 
                        style="width: 100%; height: 800px; border: 2px solid #ddd; border-radius: 8px;">
                </iframe>
            </div>
        </div>
    </div>

    <!-- Acciones de Autorizaci칩n -->
    <div class="acciones-box">
        @if (Model.Encabezado.Estado == 1)
        {
            <div class="acciones-titulo">
                <i class="fas fa-tasks"></i> Acciones del Autorizador
            </div>

            <div class="firma-info-box">
                <i class="fas fa-info-circle"></i>
                <p>
                    Al autorizar esta solicitud, su firma registrada se agregar치 autom치ticamente al documento.
                    <a href="@Url.Action("MiFirma", "Firmas")" target="_blank" style="color: #2196F3; font-weight: bold;">
                        <i class="fas fa-pen-fancy"></i> Gestionar mi firma
                    </a>
                </p>
            </div>
            
            <div class="botones-container">
                <form asp-action="AutorizarSolicitud" method="post" class="inline-form" onsubmit="return confirm('쮼st치 seguro de autorizar esta solicitud? Su firma se agregar치 autom치ticamente.');">
                    <input type="hidden" name="idSolicitud" value="@Model.Encabezado.IdSolicitud" />
                    <button type="submit" class="btn btn-success boton-accion-grande">
                        <i class="fas fa-check-circle"></i> Autorizar Solicitud
                    </button>
                </form>

                <form asp-action="Rechazar" method="post" class="inline-form" onsubmit="return confirmarRechazo(event);">
                    <input type="hidden" name="idSolicitud" value="@Model.Encabezado.IdSolicitud" />
                    <input type="hidden" name="idAutorizador" value="@idAutorizador" />
                    <input type="hidden" name="observaciones" id="observacionesRechazo" value="" />
                    <button type="submit" class="btn btn-danger boton-accion-grande">
                        <i class="fas fa-times-circle"></i> Rechazar Solicitud
                    </button>
                </form>

                <a href="@Url.Action("Autorizar", "Solicitudes")" class="btn btn-secondary boton-accion-grande">
                    <i class="fas fa-arrow-left"></i> Volver a Lista
                </a>
            </div>
        }
        else
        {
            <div class="botones-container" style="justify-content: center;">
                <a href="@Url.Action("Autorizar", "Solicitudes")" class="btn btn-secondary boton-accion-grande">
                    <i class="fas fa-arrow-left"></i> Volver a Lista
                </a>
            </div>
        }
    </div>
</div>

<!-- Secci칩n de Observaciones/Motivo del Rechazo (fuera del PDF) -->
@if (Model.Encabezado.Estado == 6 && !string.IsNullOrEmpty(Model.Encabezado.MotivoRechazo))
{
    <div class="empleado-detalle-container" style="margin-top: 20px;">
        <div class="empleado-card" style="border-left: 4px solid #DC2626; background: linear-gradient(135deg, #FEE2E2, #FECACA);">
            <div class="info-section">
                <div class="section-header" style="border-bottom: 2px solid #DC2626;">
                    <h3 class="section-title" style="color: #991B1B;">
                        <i class="fas fa-exclamation-triangle" style="color: #DC2626;"></i> Motivo del Rechazo
                    </h3>
                </div>
                <div style="padding: 20px; background: white; border-radius: 8px; margin-top: 15px;">
                    <p style="margin: 0; color: #7F1D1D; font-size: 16px; line-height: 1.6;">
                        <strong>Observaciones del autorizador:</strong><br>
                        @Model.Encabezado.MotivoRechazo
                    </p>
                </div>
            </div>
        </div>
    </div>
}

<!-- Modal para visualizar el documento -->
<div id="verDocumentoModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:2000; padding:20px; box-sizing:border-box;">
    <div style="width:100%; max-width:1000px; margin:20px auto; background:#fff; border-radius:8px; overflow:hidden; display:flex; flex-direction:column; height:calc(100% - 40px);">
        <div style="padding:15px 20px; background:#003C9D; color:white; display:flex; justify-content:space-between; align-items:center;">
            <h3 style="margin:0; font-size:1.2em;">Documento Firmado</h3>
            <button id="closePdfModal" style="background:none; border:none; color:white; font-size:1.5em; cursor:pointer;">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div style="flex:1; padding:0; overflow:hidden;">
            <!-- Usamos iframe en lugar de object -->
            <iframe id="pdfViewer" src="" type="application/pdf" style="width:100%; height:100%; min-height:500px; border:none;"></iframe>
        </div>
        <div style="padding:15px 20px; background:#f5f5f5; display:flex; justify-content:flex-end; gap:10px;">
            <button id="btnDescargar" class="btn btn-primary">
                <i class="fas fa-download"></i> Descargar
            </button>
            <button id="closePdfModalBtn" class="btn btn-secondary">
                <i class="fas fa-times"></i> Cerrar
            </button>
        </div>
    </div>
</div>

@section Styles {
    <link rel="stylesheet" href="~/css/empresas.css" />
    <link rel="stylesheet" href="~/css/detalle-solicitud.css" />
}

<style>
    .pdf-preview-container {
        margin-top: 1rem;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        border-radius: 8px;
        overflow: hidden;
    }

    .acciones-box {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 1.5rem;
        margin-top: 2rem;
        padding: 2rem;
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        border-top: 3px solid #002244;
        border-radius: 0 0 12px 12px;
        box-shadow: 0 -4px 6px rgba(0,0,0,0.1);
    }

    .acciones-titulo {
        font-size: 1.3rem;
        font-weight: bold;
        color: #002244;
        margin-bottom: 0.5rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .acciones-titulo i {
        font-size: 1.5rem;
    }

    .firma-info-box {
        background: #e3f2fd;
        border-left: 4px solid #2196F3;
        padding: 1rem 1.5rem;
        margin: 1rem 0;
        border-radius: 4px;
        display: flex;
        align-items: center;
        gap: 1rem;
    }

    .firma-info-box i {
        font-size: 1.5rem;
        color: #2196F3;
    }

    .firma-info-box p {
        margin: 0;
        color: #333;
        line-height: 1.6;
    }

    .botones-container {
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
        justify-content: center;
        align-items: center;
    }

    .inline-form {
        display: inline-block;
    }

    .boton-accion {
        padding: 0.6rem 1.5rem;
        font-size: 1rem;
        border-radius: 8px;
        min-width: 140px;
        transition: all 0.3s ease;
    }

        .boton-accion i {
            margin-right: 8px;
        }

    .boton-accion-grande {
        padding: 1rem 2.5rem;
        font-size: 1.1rem;
        font-weight: bold;
        border-radius: 10px;
        min-width: 220px;
        transition: all 0.3s ease;
        box-shadow: 0 4px 6px rgba(0,0,0,0.2);
    }

        .boton-accion-grande:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.3);
        }

        .boton-accion-grande i {
            margin-right: 10px;
            font-size: 1.2rem;
        }

    .tabla-fechas-solicitadas td, .tabla-fechas-solicitadas th {
        padding: 1rem !important;
        font-size: 1rem;
    }

    /* Notificaci칩n de 칠xito */
    .notification {
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 15px 20px;
        border-radius: 5px;
        color: white;
        font-weight: bold;
        z-index: 9999;
        opacity: 0;
        transform: translateX(100%);
        transition: all 0.3s ease;
    }

        .notification.success {
            background-color: #28a745;
        }

        .notification.show {
            opacity: 1;
            transform: translateX(0);
        }
</style>

<!-- Scripts para PDF - Usando pdfMake -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>

<script>
    // Datos de la solicitud para JavaScript
    const solicitudData = {
        idSolicitud: @Model.Encabezado.IdSolicitud,
        nombreEmpleado: '@Html.Raw(Model.Encabezado.NombreEmpleado)',
        codigoEmpleado: '@Html.Raw(empleado?.CodigoEmpleado ?? "")',
        departamento: '@Html.Raw(empleado?.Departamento ?? "")',
        puesto: '@Html.Raw(empleado?.Puesto ?? "")',
        fechaIngreso: '@(empleado?.FechaIngreso?.ToString("dd/MM/yyyy") ?? "")',
        correo: '@Html.Raw(empleado?.CorreoInstitucional ?? "")',
        telefono: '@Html.Raw(empleado?.Telefono ?? "")',
        fechaSolicitud: '@Model.Encabezado.FechaIngresoSolicitud.ToString("dd/MM/yyyy")',
        diasSolicitados: @Model.Encabezado.DiasSolicitadosTotal,
        estado: '@Html.Raw(Model.Encabezado.Estado)',
        detalles: [
            @foreach (var detalle in Model.Detalles)
            {
                    <text>{
                        fechaInicio: '@detalle.FechaInicio.ToString("dd/MM/yyyy")',
                        fechaFin: '@detalle.FechaFin.ToString("dd/MM/yyyy")',
                        diasHabiles: @detalle.DiasHabilesTomados
                    },</text>
            }
        ]
    };

    function generarPDF() {
        console.log('Iniciando generaci칩n de PDF con pdfMake...');

        // Cambiar texto del bot칩n
        const btnPdf = document.getElementById('btn-pdf');
        const pdfText = document.getElementById('pdf-text');
        const textoOriginal = pdfText.textContent;

        pdfText.textContent = 'Generando...';
        btnPdf.disabled = true;

        // Funci칩n para restaurar bot칩n
        function restaurarBoton() {
            pdfText.textContent = textoOriginal;
            btnPdf.disabled = false;
        }

        // Verificar que pdfMake est칠 disponible
        if (typeof pdfMake === 'undefined') {
            alert('Error: No se pudo cargar la librer칤a PDF. Verifique su conexi칩n a internet.');
            restaurarBoton();
            return;
        }

        try {
            // Crear filas de la tabla de detalles
            const filasTabla = [
                // Cabecera de la tabla
                [
                    { text: 'Fecha Inicio', style: 'tableHeader' },
                    { text: 'Fecha Fin', style: 'tableHeader' },
                    { text: 'D칤as H치biles', style: 'tableHeader' }
                ]
            ];

            // Agregar filas de datos
            solicitudData.detalles.forEach(detalle => {
                filasTabla.push([
                    { text: detalle.fechaInicio, style: 'tableCell' },
                    { text: detalle.fechaFin, style: 'tableCell' },
                    { text: detalle.diasHabiles.toString(), style: 'tableCell', alignment: 'center' }
                ]);
            });

            // Definici칩n del documento PDF - VERSI칍N MEJORADA
            const docDefinition = {
                pageSize: 'A4',
                pageMargins: [40, 40, 40, 40],

                content: [
                    // T칤tulo principal - con colores m치s fuertes
                    {
                        text: 'Detalle de Solicitud',
                        style: 'mainTitle',
                        margin: [0, 0, 0, 8]
                    },

                    // Subt칤tulo - con color m치s fuerte
                    {
                        text: 'Informaci칩n detallada sobre la solicitud de vacaciones',
                        style: 'subtitle',
                        margin: [0, 0, 0, 20]
                    },

                    // N칰mero de solicitud - con color m치s fuerte
                    {
                        text: `N칰mero de solicitud: ${solicitudData.idSolicitud}`,
                        style: 'solicitudNumber',
                        margin: [0, 0, 0, 25]
                    },

                    // Secci칩n de d칤as solicitados y fecha - mejorada
                    {
                        table: {
                            widths: ['50%', '50%'],
                            body: [
                                [
                                    {
                                        stack: [
                                            { text: 'D칤as solicitados', style: 'statLabel', alignment: 'center' },
                                            { text: `${solicitudData.diasSolicitados} d칤as`, style: 'statValue', alignment: 'center' }
                                        ],
                                        border: [false, false, false, false]
                                    },
                                    {
                                        stack: [
                                            { text: 'Fecha de creaci칩n', style: 'statLabel', alignment: 'center' },
                                            { text: solicitudData.fechaSolicitud, style: 'statValue', alignment: 'center' }
                                        ],
                                        border: [false, false, false, false]
                                    }
                                ]
                            ]
                        },
                        layout: 'noBorders',
                        margin: [0, 0, 0, 30]
                    },

                    // T칤tulo "Informaci칩n del Empleado" - mejorado
                    {
                        text: 'Informaci칩n del Empleado',
                        style: 'sectionTitle',
                        margin: [0, 0, 0, 20]
                    },

                    // Grid de informaci칩n del empleado - mejorado
                    {
                        table: {
                            widths: ['33%', '33%', '34%'],
                            body: [
                                [
                                    {
                                        stack: [
                                            { text: 'C칩digo', style: 'fieldLabel' },
                                            { text: solicitudData.codigoEmpleado, style: 'fieldValue' }
                                        ],
                                        border: [false, false, false, false],
                                        margin: [0, 0, 10, 15]
                                    },
                                    {
                                        stack: [
                                            { text: 'Departamento', style: 'fieldLabel' },
                                            { text: solicitudData.departamento, style: 'fieldValue' }
                                        ],
                                        border: [false, false, false, false],
                                        margin: [0, 0, 10, 15]
                                    },
                                    {
                                        stack: [
                                            { text: 'Puesto', style: 'fieldLabel' },
                                            { text: solicitudData.puesto, style: 'fieldValue' }
                                        ],
                                        border: [false, false, false, false],
                                        margin: [0, 0, 0, 15]
                                    }
                                ],
                                [
                                    {
                                        stack: [
                                            { text: 'Fecha de Ingreso', style: 'fieldLabel' },
                                            { text: solicitudData.fechaIngreso, style: 'fieldValue' }
                                        ],
                                        border: [false, false, false, false],
                                        margin: [0, 0, 10, 0]
                                    },
                                    {
                                        stack: [
                                            { text: 'Correo', style: 'fieldLabel' },
                                            { text: solicitudData.correo, style: 'fieldValue' }
                                        ],
                                        border: [false, false, false, false],
                                        margin: [0, 0, 10, 0]
                                    },
                                    {
                                        stack: [
                                            { text: 'Tel칠fono', style: 'fieldLabel' },
                                            { text: solicitudData.telefono, style: 'fieldValue' }
                                        ],
                                        border: [false, false, false, false],
                                        margin: [0, 0, 0, 0]
                                    }
                                ]
                            ]
                        },
                        layout: 'noBorders',
                        margin: [0, 0, 0, 30]
                    },

                    // T칤tulo "Fechas Solicitadas" - mejorado
                    {
                        text: 'Fechas Solicitadas',
                        style: 'sectionTitle',
                        margin: [0, 0, 0, 20]
                    },

                    // Tabla de fechas - mejorada
                    {
                        table: {
                            headerRows: 1,
                            widths: ['*', '*', '*'],
                            body: filasTabla
                        },
                        layout: {
                            hLineWidth: function (i, node) {
                                return (i === 0 || i === node.table.body.length) ? 2 : 1;
                            },
                            vLineWidth: function (i, node) {
                                return (i === 0 || i === node.table.widths.length) ? 2 : 1;
                            },
                            hLineColor: function (i, node) {
                                return (i === 0 || i === node.table.body.length) ? '#2c3e50' : '#bdc3c7';
                            },
                            vLineColor: function (i, node) {
                                return (i === 0 || i === node.table.widths.length) ? '#2c3e50' : '#bdc3c7';
                            },
                            fillColor: function (rowIndex, node, columnIndex) {
                                return (rowIndex === 0) ? '#ecf0f1' : (rowIndex % 2 === 0 ? '#f8f9fa' : null);
                            },
                            paddingLeft: function(i, node) { return 8; },
                            paddingRight: function(i, node) { return 8; },
                            paddingTop: function(i, node) { return 8; },
                            paddingBottom: function(i, node) { return 8; }
                        },
                        margin: [0, 0, 0, 20]
                    }
                ],

                styles: {
                    mainTitle: {
                        fontSize: 22,
                        bold: true,
                        color: '#2c3e50'  // Azul oscuro fuerte
                    },
                    subtitle: {
                        fontSize: 13,
                        color: '#34495e',  // Gris azulado fuerte
                        italics: true
                    },
                    solicitudNumber: {
                        fontSize: 12,
                        color: '#2c3e50',  // Azul oscuro fuerte
                        bold: true
                    },
                    statLabel: {
                        fontSize: 11,
                        color: '#7f8c8d',  // Gris fuerte
                        margin: [0, 0, 0, 5]
                    },
                    statValue: {
                        fontSize: 16,
                        bold: true,
                        color: '#e74c3c'  // Rojo fuerte para destacar
                    },
                    sectionTitle: {
                        fontSize: 16,
                        bold: true,
                        color: '#2980b9',  // Azul fuerte
                        decoration: 'underline'
                    },
                    fieldLabel: {
                        fontSize: 11,
                        color: '#3498db',  // Azul brillante fuerte
                        bold: true,
                        margin: [0, 0, 0, 3]
                    },
                    fieldValue: {
                        fontSize: 11,
                        color: '#2c3e50'  // Azul oscuro fuerte
                    },
                    tableHeader: {
                        fontSize: 12,
                        bold: true,
                        color: '#2c3e50',  // Azul oscuro fuerte
                        alignment: 'center'
                    },
                    tableCell: {
                        fontSize: 11,
                        color: '#34495e',  // Gris azulado fuerte
                        alignment: 'center'
                    }
                }
            };

            // Generar y descargar el PDF
            pdfMake.createPdf(docDefinition).download(`Solicitud_Vacaciones_${solicitudData.idSolicitud}_${new Date().toISOString().slice(0, 10)}.pdf`);

            // Mostrar notificaci칩n de 칠xito
            mostrarNotificacion("Archivo PDF exportado exitosamente", "success");

            // Restaurar bot칩n
            restaurarBoton();

        } catch (error) {
            console.error('Error al generar PDF:', error);
            alert('Error al generar el PDF: ' + error.message);
            restaurarBoton();
        }
    }

    // Funci칩n para mostrar notificaciones
    function mostrarNotificacion(mensaje, tipo) {
        // Crear elemento de notificaci칩n
        const notification = document.createElement('div');
        notification.className = `notification ${tipo}`;
        notification.textContent = mensaje;

        // Agregar al DOM
        document.body.appendChild(notification);

        // Mostrar con animaci칩n
        setTimeout(() => {
            notification.classList.add('show');
        }, 100);

        // Ocultar despu칠s de 3 segundos
        setTimeout(() => {
            notification.classList.remove('show');
            setTimeout(() => {
                document.body.removeChild(notification);
            }, 300);
        }, 3000);
    }

    // Funci칩n para abrir el modal del documento
    function abrirModalDocumento(idSolicitud) {
        const modal = document.getElementById("verDocumentoModal");
        const pdfViewer = document.getElementById("pdfViewer");

        // Aqu칤 cargamos el PDF directamente desde el controlador
        pdfViewer.src = `/Solicitudes/VerDocumento?idSolicitud=${idSolicitud}`;

        modal.style.display = "block";
        document.body.style.overflow = "hidden";
    }

    // Cerrar modal al hacer clic en la X
    document.getElementById('closePdfModal')?.addEventListener('click', function() {
        const modal = document.getElementById('verDocumentoModal');
        modal.style.display = 'none';
        document.body.style.overflow = 'auto';
    });

    // Cerrar modal al hacer clic en el bot칩n Cerrar
    document.getElementById('closePdfModalBtn')?.addEventListener('click', function() {
        const modal = document.getElementById('verDocumentoModal');
        modal.style.display = 'none';
        document.body.style.overflow = 'auto';
    });

    // Cerrar modal al hacer clic fuera del contenido
    document.getElementById('verDocumentoModal')?.addEventListener('click', function(e) {
        if (e.target === this) {
            this.style.display = 'none';
            document.body.style.overflow = 'auto';
        }
    });

    // Cerrar con tecla ESC
    document.addEventListener('keydown', function(e) {
        const modal = document.getElementById('verDocumentoModal');
        if (e.key === 'Escape' && modal.style.display === 'block') {
            modal.style.display = 'none';
            document.body.style.overflow = 'auto';
        }
    });

    // Verificar carga de librer칤as al cargar la p치gina
    document.addEventListener('DOMContentLoaded', function() {
        console.log('Verificando pdfMake...');

        if (typeof pdfMake !== 'undefined') {
            console.log('pdfMake cargado correctamente');
        } else {
            console.error('pdfMake NO est치 disponible');
        }

        // Manejar el modal del visor de PDF
        const verDocumentoBtn = document.querySelector('[data-bs-target="#verDocumentoModal"]');
        const verDocumentoModal = document.getElementById('verDocumentoModal');
        const closePdfModal = document.getElementById('closePdfModal');
        const closePdfModalBtn = document.getElementById('closePdfModalBtn');

        if (verDocumentoBtn) {
            verDocumentoBtn.addEventListener('click', function(e) {
                e.preventDefault();
                verDocumentoModal.style.display = 'block';
                document.body.style.overflow = 'hidden'; // Evitar scroll del body
            });
        }

        // Cerrar modal al hacer clic en la X
        if (closePdfModal) {
            closePdfModal.addEventListener('click', function() {
                verDocumentoModal.style.display = 'none';
                document.body.style.overflow = 'auto';
            });
        }

        // Cerrar modal al hacer clic en el bot칩n Cerrar
        if (closePdfModalBtn) {
            closePdfModalBtn.addEventListener('click', function() {
                verDocumentoModal.style.display = 'none';
                document.body.style.overflow = 'auto';
            });
        }

        // Cerrar modal al hacer clic fuera del contenido
        verDocumentoModal.addEventListener('click', function(e) {
            if (e.target === verDocumentoModal) {
                verDocumentoModal.style.display = 'none';
                document.body.style.overflow = 'auto';
            }
        });

        // Cerrar con tecla ESC
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && verDocumentoModal.style.display === 'block') {
                verDocumentoModal.style.display = 'none';
                document.body.style.overflow = 'auto';
            }
        });
    });

    // Funci칩n para confirmar rechazo con observaciones
    function confirmarRechazo(event) {
        event.preventDefault();
        
        const motivo = prompt('Por favor, ingrese el motivo del rechazo (opcional):');
        
        // Si el usuario cancela, no enviar el formulario
        if (motivo === null) {
            return false;
        }
        
        // Confirmar la acci칩n
        if (confirm('쮼st치 seguro de que desea rechazar esta solicitud?')) {
            // Agregar el motivo al campo oculto
            document.getElementById('observacionesRechazo').value = motivo;
            // Obtener el formulario y enviarlo
            const form = event.target;
            console.log('游닋 Enviando formulario de rechazo...', {
                idSolicitud: form.querySelector('[name="idSolicitud"]').value,
                idAutorizador: form.querySelector('[name="idAutorizador"]').value,
                observaciones: motivo
            });
            form.submit();
            return true;
        }
        
        return false;
    }
</script>
